<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="board.js"></script>

    <title>WebSockets</title>
</head>
<body>
    <div id="board">
        <div class="half">
            <div class="quarter" id="second__quarter"></div>
            <div class="quarter" id="third__quarter">
            </div>
        </div>
        <div id="frame"></div>
        <div class="half">
            <div class="quarter" id="first__quarter">
            </div>
            <div class="quarter" id="fourth__quarter"></div>
        </div>
    </div>
    <script type="module" src="../src/index.js"></script>
    <script>
        const socket = new WebSocket('ws://127.0.0.1:8000');
        const stylePieces = (e, piece, isTopTriangle, children) => {
            let style = piece.style;
            let counter = 0;
            for (const node of children) {
                if (isTopTriangle) {
                    style.bottom = null;
                    style.top = `${counter * 60}px`;
                } else {
                    style.top = null;
                    style.bottom = `${counter * 60}px`;
                }
                counter++;
            }
        }

        socket.addEventListener('open', () => {
            console.log('Connected to WebSocket server');
        });

        socket.addEventListener('message', event => {
            const data = JSON.parse(event.data);
            const piece = document.getElementById(data.pieceId);
            const targetTriangle = document.querySelector(`[triangle-id="${data.triangleId}"]`);
            const isTopTriangle = (targetTriangle.style.alignSelf === 'start');
            let children = targetTriangle.childNodes;
            targetTriangle.append(piece);
            stylePieces(event, piece, isTopTriangle, children);
        });
    </script>
</body>
</html>